/*
* Kendo UI Beta v2012.3.1322 (http://kendoui.com)
* Copyright 2013 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

("function"==typeof define&&define.amd?define:function(e,t){return t()})(["./kendo.mobile.application.min"],function(){(function(e){function t(){return this.nodeType===r.TEXT_NODE&&this.nodeValue.match(R)}function n(e,t){t&&e.prepend('<span class="km-icon km-'+t+'"/>')}function l(e){n(e,_(e,"icon"))}function o(e){var l=e.parent(),o=e.add(l.children(a.roleSelector("detailbutton"))),i=l.contents().not(o).not(t);i.length||(e.addClass("km-listview-link").attr(a.attr("role"),"listview-link"),n(e,_(l,"icon")))}function i(e){if(e.children("input[type=checkbox],input[type=radio]").length){var t=e.parent();t.contents().not(e).not(function(){return 3==this.nodeType})[0]||e.addClass("km-listview-label")}}var a=window.kendo,r=window.Node,s=a.mobile,d=s.ui,c=a.data.DataSource,u=d.Widget,p=".km-list > li, > li:not(.km-group-container)",h=".km-listview-link, .km-listview-label",f=e.proxy,_=a.attrValue,g="km-group-title",m="km-state-active",v='<div class="'+g+'"><div class="km-text"></div></div>',k=a.template('<li><div class="'+g+'"><div class="km-text">#= this.headerTemplate(data) #</div></div><ul>#= kendo.render(this.template, data.items)#</ul></li>'),T='<div class="km-listview-wrapper" />',S=".kendoMobileListView",w="lastPageReached",b="click",H="touchend click",y=H.split(" ").join(S+" ")+S,x="change",C="progress",I="function",R=/^\s+$/,L=/button/,B=u.extend({init:function(e,t){var n=this;u.fn.init.call(n,e,t),e=n.element,t=n.options,e.on("down",h,"_highlight").on("move up cancel",h,"_dim").on(H,p,"_click"),e.wrap(T),n.wrapper=n.element.parent(),n._footer(),n._dataSource(),n._bindScroller(),n._fixHeaders(),t.dataSource&&n.options.autoBind?n.dataSource.fetch():n._style(),a.notify(n,d)},events:[b,w],options:{name:"ListView",style:"",type:"flat",autoBind:!0,fixedHeaders:!1,template:"#:data#",headerTemplate:'<span class="km-text">#:value#</span>',appendOnRefresh:!1,loadMore:!1,loadMoreText:"Press to load more",endlessScroll:!1,scrollTreshold:30,pullToRefresh:!1,pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing",pullOffset:140},setOptions:function(e){u.fn.setOptions.call(this,e)},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.options.autoBind&&e.fetch()},destroy:function(){var e=this;u.fn.destroy.call(e),e._unbindDataSource(),e.stopEndlessScrolling(),e.stopLoadMore(),a.destroy(e.element)},refresh:function(t){t=t||{};var n,l,o,i=this,r=i.element,c=i.options,u=i.dataSource,p=u.view(),h=i.loading,f="html";return"itemchange"===t.action?(l=t.items[0],o=e(i.template(l)),r.find("[data-"+a.ns+"uid="+l.uid+"]").replaceWith(o),i.trigger("itemChange",{item:o,data:l,ns:d}),i._style(),undefined):(i.template||i._templates(),i._cacheDataItems(p),i.trigger("dataBinding"),u.group()[0]?(c.type="group",n=a.render(i.groupTemplate,p)):n=a.render(i.template,p),h?f="append":c.appendOnRefresh&&(f="prepend"),n=e(n),r[f](n),s.init(n),h&&(i.loading=!1,i._calcTreshold(),i._toggleLoader(!1)),c.pullToRefresh&&i._scroller().pullHandled(),i._hideLoading(),i._shouldFixHeaders(),i._style(),i.trigger("dataBound",{ns:d}),undefined)},_cacheDataItems:function(e){var t,n=this;n.element[0].firstChild||(n._firstOrigin=n._first=e[0],n._last=e[e.length-1]),n._pulled&&(t=e[0],n._pulled=!1,t&&(n._first=t)),n.loading&&(t=e[e.length-1],t&&(n._last=t))},items:function(){return"group"===this.options.type?this.element.find(".km-list").children():this.element.children()},stopEndlessScrolling:function(){var e=this,t=e._scroller();t&&e._loadIcon&&(e.loading=!1,e._loadIcon.parent().hide(),t.unbind("resize",e._scrollerResize).unbind("scroll",e._scrollerScroll),e.trigger(w))},stopLoadMore:function(){var e=this;e._loadButton&&(e.loading=!1,e._loadButton.off(y).parent().hide(),e.trigger(w))},_dim:function(e){this._toggle(e,!1)},_highlight:function(e){this._toggle(e,!0)},_toggle:function(t,n){if(!(t.which>1)){var l=e(t.currentTarget),o=l.parent(),i=_(l,"role")||"",a=!i.match(L),r=t.isDefaultPrevented();a&&o.toggleClass(m,n&&!r)}},_unbindDataSource:function(){var e=this;e.dataSource.unbind(x,e._refreshHandler).unbind(C,e._progressHandler)},_dataSource:function(){var e=this,t=e.options;e.dataSource&&e._refreshHandler?e._unbindDataSource():(e._refreshHandler=f(e.refresh,e),e._progressHandler=f(e._showLoading,e)),e.dataSource=c.create(t.dataSource).bind(x,e._refreshHandler),t.pullToRefresh||t.loadMore||t.endlessScroll||e.dataSource.bind(C,e._progressHandler)},_fixHeader:function(t){var n,l,o,i=0,a=this,r=a._scroller(),s=t.scrollTop,d=a.headers;if(a.fixedHeaders){do{if(n=d[i++],!n){o=e("<div />");break}l=n.offset,o=n.header}while(l>s);a.currentHeader!=i&&(r.fixedContainer.html(o.clone()),a.currentHeader=i)}},_shouldFixHeaders:function(){this.fixedHeaders="group"===this.options.type&&this.options.fixedHeaders},_cacheHeaders:function(){var t=this,n=[];t.fixedHeaders&&(t.element.find("."+g).each(function(t,l){l=e(l),n.unshift({offset:l.position().top,header:l})}),t.headers=n,t._fixHeader({scrollTop:0}))},_fixHeaders:function(){var e=this,t=e._scroller();e._shouldFixHeaders(),t&&(a.onResize(function(){e._cacheHeaders()}),t.bind("scroll",function(t){e._fixHeader(t)}))},_bindScroller:function(){var e=this,t=e.options,n=e._scroller();n&&(t.pullToRefresh&&n.setOptions({pullToRefresh:!0,pull:function(){var n=t.pullParameters,l={page:1};n&&(l=n.call(e,e._first)),e._pulled=!0,e.dataSource.read(l)},pullTemplate:t.pullTemplate,releaseTemplate:t.releaseTemplate,refreshTemplate:t.refreshTemplate}),t.endlessScroll&&(e._scrollHeight=n.element.height(),e._scrollerResize=function(){e._scrollHeight=n.element.height(),e._calcTreshold()},e._scrollerScroll=function(t){!e.loading&&t.scrollTop+e._scrollHeight>e._treshold&&e._nextPage()},n.setOptions({resize:e._scrollerResize,scroll:e._scrollerScroll})))},_calcTreshold:function(){var e=this,t=e._scroller();t&&(e._treshold=t.scrollHeight()-e.options.scrollTreshold)},_nextPage:function(){var e,t=this,n=t.options,l=n.endlessScrollParameters||n.loadMoreParameters;t.loading=!0,t._toggleLoader(!0),l&&(e=l.call(t,t._firstOrigin,t._last)),t.dataSource.next(e)||(t.stopLoadMore(),t.stopEndlessScrolling())},_templates:function(){var e=this,t=e.options.template,n=e.options.headerTemplate,l=' data-uid="#=data.uid || ""#"',o={},i={};typeof t===I&&(o.template=t,t="#=this.template(data)#"),i.template=e.template=f(a.template("<li"+l+">"+t+"</li>"),o),typeof n===I&&(i._headerTemplate=n,n="#=this._headerTemplate(data)#"),i.headerTemplate=a.template(n),e.groupTemplate=f(k,i)},_click:function(t){if(!(t.which>1||t.isDefaultPrevented())){var n,l=this,o=e(t.currentTarget),i=e(t.target),r=i.closest(a.roleSelector("button","detailbutton","backbutton")),s=a.widgetInstance(r,d),c=o.attr(a.attr("uid"));c&&(n=l.dataSource.getByUid(c)),l.trigger(b,{target:i,item:o,dataItem:n,button:s})&&t.preventDefault()}},_style:function(){var t=this,n=t.options,l="group"===n.type,o=t.element,i="inset"===n.style;o.addClass("km-listview").toggleClass("km-list",!l).toggleClass("km-listinset",!l&&i).toggleClass("km-listgroup",l&&!i).toggleClass("km-listgroupinset",l&&i),l&&(o.children().children("ul").addClass("km-list"),o.children("li").each(function(){var t=e(this),n=t.contents().first();t.addClass("km-group-container"),n.is("ul")||n.is("div."+g)||n.wrap(v)})),t._enhanceItems(),o.parents(".km-listview")[0]||o.closest(".km-content").toggleClass("km-insetcontent",i),t._cacheHeaders()},_enhanceItems:function(){this.items().each(function(){var t,n=e(this),a=!1;n.children().each(function(){t=e(this),t.is("a")?(o(t),a=!0):t.is("label")&&(i(t),a=!0)}),a||l(n)})},_footer:function(){var t,n=this,l=n.options,o=l.loadMore;(o||l.endlessScroll)&&(n._loadIcon=e('<span style="display:none" class="km-icon"></span>'),t=e('<span class="km-load-more"></span>').append(n._loadIcon),o&&(n._loadButton=e('<button class="km-load km-button">'+l.loadMoreText+"</button>").on(y,f(n._nextPage,n)),t.append(n._loadButton)),n.wrapper.append(t))},_toggleLoader:function(e){var t=this,n=t._loadIcon,l=t._loadButton;l&&l.toggle(!e),e?n.css("display","block"):n.hide()},_scroller:function(){var e,t=this;return t._scrollerInstance||(e=t.view(),t._scrollerInstance=e&&e.scroller),t._scrollerInstance},_showLoading:function(){var e=this.view();e&&e.loader.show()},_hideLoading:function(){var e=this.view();e&&e.loader.hide()}});d.plugin(B)})(window.kendo.jQuery)});